<!DOCTYPE html>
<html>
<head>
    <title>GOVMAP - Sea Level Stations</title>
    <script src="https://www.govmap.gov.il/govmap/api/govmap.api.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { width: 100%; height: 500px; }
        .loading { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 500px; 
            background: #f0f0f0;
            color: #333;
        }
        .error {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 500px;
            background: #ffe6e6;
            color: #d00;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div>Loading GovMap...</div>
    </div>
    <div id="map" style="display: none;"></div>
    <div id="error" class="error" style="display: none;">
        <div>
            <h3>GovMap Unavailable</h3>
            <p>Unable to load GovMap API or station data</p>
            <p>This may be due to network issues or API limitations</p>
        </div>
    </div>
    <script>
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('map').style.display = 'none';
            document.getElementById('error').style.display = 'flex';
            console.error('GovMap Error:', message);
        }
        
        function showMap() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('map').style.display = 'block';
        }
        
        window.onload = function() {
            try {
                if (typeof govmap === 'undefined') {
                    throw new Error('GovMap API not loaded');
                }
                
                govmap.token = "11aa3021-4ae0-4771-8ae0-df75e73fe73e";
                
                fetch('http://localhost:8000/stations/map')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            throw new Error('No station data');
                        }
                        
                        govmap.createMap("map", {
                            token: govmap.token,
                            layers: [],
                            center: [35.0, 31.5],
                            zoom: 7
                        });
                        
                        data.forEach(station => {
                            govmap.drawGeometries([{
                                geometryType: govmap.geometryType.circle,
                                data: { x: station.x, y: station.y, radius: 500 },
                                style: { fillColor: 'blue', borderColor: 'darkblue', borderWidth: 2 },
                                tooltip: station.name + ' - Sea Level Station'
                            }]);
                        });
                        
                        showMap();
                    })
                    .catch(error => {
                        showError('Failed to load: ' + error.message);
                    });
                    
            } catch (error) {
                showError('Init failed: ' + error.message);
            }
        };
    </script>
</body>
</html>